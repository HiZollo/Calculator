import { Calculator } from "./calculator";

const calculator = new Calculator(true);

numericalTest({
  "unary operator": [
    { input: "+25", output: 25 },
    { input: "-25", output: -25 },
    { input: "~25", output: -26 },
    { input: "√25", output: 5 },
    { input: "√√505712234.7424647", output: 149.96014965879436 }, 
    { input: "-√645199168.8916563", output: -25400.771029471845 },
    { input: "+-156360379.27315012", output: -156360379.27315012 },
    { input: "--+61898616.16523558", output: 61898616.16523558 },
    { input: "~-√660399463.1485146", output: 25697 },
    { input: "~+√488818281.84343547", output: -22110 },
    { input: "√-+-311101832.7342022", output: 17638.079054539987 },
    { input: "~+~-1959229539.5059218", output: -1959229539 },
    { input: "~-~~1552853005.9536", output: 1552853004 },
    { input: "-+-~~716933272.2185487", output: 716933272 },
    { input: "√√-~+1643441249.5549684", output: 201.34393212518358 },
    { input: "~-~√+1592677260.3112335", output: -39910 },
    { input: "~-~√+-998197017.1160694", output: -2 },
    { input: "√-~√~-268622311.70796084", output: 128.0234353546256 },
    { input: "~--~~-457878957.9621833", output: 457878956 },
    { input: "-+++-~~231854287.61907998", output: 231854287 },
    { input: "-√---~√547716115.502172", output: -152.9836592581051 },
    { input: "+-~√~+-546388725.1218129", output: 23375 },
    { input: "~~-√--√√131249232.20555492", output: -10 },
    { input: "~-++~-√-1338241468.9875891", output: -2 },
    { input: "+-+-√~+-899893919.8517596", output: 29998.231914564563 },
    { input: "√-~--√√√√1350763121.5895698", output: 2 },
    { input: "--++√-+~+545832137.7696322", output: 23363.050699769497 },
    { input: "+~√√√+~-√612721735.8495455", output: -4 },
    { input: "~√~+~-~++√853309394.3393054", output: -171 },
    { input: "~+-~~√√-+-1052156197.8166765", output: 179 },
    { input: "++~---~+√~54389450.304182194", output: -2 },
  ], 

  "binary operator": [
    { input: "9 ** 9", output: 387420489 }, 
    { input: "3 ** -6", output: 0.0013717421124828533 },
    { input: "-5 ** 3", output: -125 },
    { input: "-2 ** -8", output: 0.00390625 },
    { input: "2020158207 * 1645968595", output: 3325116965653509000 }, 
    { input: "875242588 * -926277825", output: -810717800760011100 }, 
    { input: "-2029908982 * 865852664", output: -1757602099742228000 }, 
    { input: "-580961235 * -403874066", output: 234635176167831520 }, 
    { input: "1610363849 / 376308642", output: 4.279369829088326 }, 
    { input: "1730798428 / -1563144280", output: -1.1072544295143376 }, 
    { input: "-1011614476 / 920255663", output: -1.0992754694952636 }, 
    { input: "-184593923 / -1791861421", output: 0.10301796826284816 }, 
    { input: "1135740484 % 793015564", output: 342724920 }, 
    { input: "23173851 % -193953867", output: 23173851 }, 
    { input: "-2022044131 % 540626342", output: -400165105 }, 
    { input: "-1602262797 % -461237705", output: -218549682 }, 
    { input: "1875289429 + 1515865437", output: 3391154866 }, 
    { input: "1424141506 + -761532231", output: 662609275 },
    { input: "-1092139632 + 28874459", output: -1063265173 },
    { input: "-1950576744 + -607334307", output: -2557911051 },
    { input: "182576053 - 1482899436", output: -1300323383 },
    { input: "548618724 - -1310376044", output: 1858994768 },
    { input: "-767470469 - 998587567", output: -1766058036 },
    { input: "-49563945 - -1185807359", output: 1136243414 },
    { input: "266908311 << 1730722140", output: 1879048192 },
    { input: "487404267 << -949485957", output: 1476395008 },
    { input: "-490148209 << 1088491210", output: 599407616 },
    { input: "-347004050 << -1766300793", output: -1466845440 },
    { input: "299926999 >> 229980138", output: 292897 },
    { input: "2135897541 >> -857953667", output: 3 },
    { input: "-1309406212 >> 1883503897", output: -40 },
    { input: "-206532707 >> -436013003", output: -99 },
    { input: "1520492955 >>> 989300462", output: 92803 }, 
    { input: "1755890705 >>> -258720186", output: 27435792 },
    { input: "-2062902585 >>> 829636489", output: 4359501 },
    { input: "-1109980434 >>> -351883215", output: 24299 },
    { input: "210952884 & 1168400827", output: 75522224 },
    { input: "1300838664 & -465799207", output: 1141387528 },
    { input: "-2130715217 & 1265611358", output: 7311374 },
    { input: "-440607836 & -882145995", output: -1054310108 },
    { input: "1502105838 ^ 713819278", output: 1929663584 },
    { input: "2026313238 ^ -1709912686", output: -489432188 },
    { input: "-742720354 ^ 182591878", output: -648487656 },
    { input: "-671343900 ^ -1531482610", output: 1934324970 },
    { input: "840538242 | 1353247347", output: 1924791027 },
    { input: "473404412 | -679918535", output: -545269763 },
    { input: "-1819281584 | 328198318", output: -1819279362 },
    { input: "-943118479 | -1261780160", output: -137631887 },
  ], 

  "arithmetic chain": [
    { input: "7 ** 8 ** -3", output: 1.0038078372203525 }, 
    { input: "201992001 * 342889126 * -1095830451", output: -7.589816019767396e+25 },
    { input: "1259514562 / -929219207 / 1213082262", output: -1.1173642254660855e-9 },
    { input: "1279040153 % 1153126784 % 543428945", output: 125913369 },
    { input: "-1680725763 + -411338311 + 1850279204", output: -241784870 },
    { input: "1824923850 - -82151694 - -671552641", output: 2578628185 },
    { input: "1894004663 << -1392402156 << -807023837", output: -612368384 },
    { input: "-3 >> -10 >> -2", output: -1 },
    { input: "-8 >>> 2 >>> 5", output: 33554431 },
    { input: "993857082 & 1836316676 & 66485162", output: 19924992 },
    { input: "252747714 ^ -1305005443 ^ 279586394", output: -1383232539 },
    { input: "-119171148 | -12860114 | 1069490544", output: -2050 },
  ], 

  "constants": [
    { input: "e", output: 2.718281828459045 }, 
    { input: "inf", output: Infinity },
    { input: "infinity", output: Infinity },
    { input: "∞", output: Infinity },
    { input: "ln10", output: 2.302585092994046 },
    { input: "ln2", output: 0.6931471805599453 },
    { input: "log10e", output: 0.4342944819032518 },
    { input: "log2e", output: 1.4426950408889634 },
    { input: "pi", output: 3.141592653589793 },
    { input: "π", output: 3.141592653589793 },
    { input: "sqrt1_2", output: 0.7071067811865476 },
    { input: "sqrt2", output: 1.4142135623730951 },
  ], 

  "precedence": [
    { input: "-724 ** 68 * -642", output: -1.8610478067851723e+197 }, 
    { input: "-427 ** -63 / 64", output: -2.998222779332518e-168 },
    { input: "2171 ** -70 % -806", output: 2.715265854250529e-234 },
    { input: "-1079305961 ** -1920032546 + 1726863272", output: 1726863272 },
    { input: "913242297 ** -1957213513 - 1798690475", output: -1798690475 },
    { input: "-1 ** -39 << -34", output: -1073741824 },
    { input: "-17 ** 9 >> -39", output: 49 },
    { input: "-96 ** 6 >>> 155", output: 8 },
    { input: "-31 ** 13 & -276", output: 505561088 }, 
    { input: "-1716432369 ** -1929764719 ^ -83597604", output: -83597604 },
    { input: "-313957835 ** 1696012261 | -241424909", output: -241424909 },
    { input: "256 * 326 ** 54", output: 1.3243121666021945e+138 },
    { input: "-1304686884 * -1484231889 / 767960944", output: 2521557760.87598 },
    { input: "-524618283 * 365436592 % 1624177194", output: -485293850 },
    { input: "-564443050 * -305991258 + 878918927", output: 172714639817775800 },
    { input: "-431139969 * 210640060 - -1849855498", output: -90815347088702640 },
    { input: "2074929356 * 1832497677 << -1300308407", output: 592707584 },
    { input: "-1597852674 * 814871875 >> 478723609", output: -2 },
    { input: "-1152879058 * 1735686272 >>> -1796209263", output: 21820 },
    { input: "-1741129769 * 1976919537 & -31616729", output: -1945010176 },
    { input: "1106701459 * 975194634 ^ 1347252566", output: -2077570346 },
    { input: "785757576 * -1507544399 | -863849080", output: -40126584 },
    { input: "234 / 308 ** -41", output: 2.5107023780575876e+104 },
    { input: "-2142712392 / -365279200 * -516147690", output: -3027700595.7776256 },
    { input: "-724158785 / 95389024 % -285529730", output: -7.591636381561049 },
    { input: "1778465281 / -1314772630 + -799912681", output: -799912682.352679 },
    { input: "-1392659815 / -1457964480 - 1645722565", output: -1645722564.0447917 },
    { input: "789414775 / -719834574 << -450649282", output: -1073741824 },
    { input: "1769386097 / -179335397 >> -94711860", output: -1 },
    { input: "-1363318617 / 263223951 >>> -1155005132", output: 4095 },
    { input: "1351250635 / -1242966226 & 1243355742", output: 1243355742 }, 
    { input: "-1294341222 / 1549504072 ^ 387928306", output: 387928306 },
    { input: "937762808 / -292418404 | 1111472181", output: -3 },
    { input: "-1260936058 % -1543720367 ** 88761636", output: -1260936058 },
    { input: "-1363736305 % -588407315 * -555219367", output: 103782534072079730 },
    { input: "698236246 % 992193687 / 245516599", output: 2.843947207007376 },
    { input: "1065769747 % -1707241386 + -1953991844", output: -888222097 },
    { input: "72294699 % 2025913581 - -1168166771", output: 1240461470 },
    { input: "-1281852959 % 855090549 << -1459464368", output: 525729792 },
    { input: "-1779883236 % -596896064 >> -1495225081", output: -4578837 },
    { input: "-245717993 % 1805786999 >>> -822900825", output: 31634760 },
    { input: "296299625 % 1643652220 & 612283303", output: 2629665 },
    { input: "1199689475 % 737940879 ^ -1845662470", output: -1971792498 },
    { input: "2073496194 % 1216331843 | -189409650", output: -138944833 },
    { input: "1110489999 + -874102571 ** -356506683", output: 1110489999 },
    { input: "1386207206 + 487269450 * -1278670600", output: -623057118606962800 },
    { input: "-782221826 + -1241216855 / 1171547972", output: -782221827.0594674 },
    { input: "486472413 + 1758882147 % -2087734033", output: 2245354560 },
    { input: "-1091087445 + -36452224 - -2109022078", output: 981482409 },
    { input: "1269896039 + 433644191 << 1437205262", output: 2105638912 },
    { input: "2082226527 + 533864812 >> 402790391", output: -201 },
    { input: "355636005 + 1193388947 >>> 1586120984", output: 92 },
    { input: "1656819189 + -1047495429 & -860485665", output: 68158160 },
    { input: "504354085 + 1843965565 ^ -428356054", output: 1838108040 },
    { input: "-86104606 + 314199323 | -1300904013", output: -1073874945 },
    { input: "-1252335318 - -185050905 ** -729885653", output: -1252335318 },
    { input: "-2089086905 - 308295562 * 81028139", output: -24980617739906024 },
    { input: "1696707046 - -1600769406 / 703968471", output: 1696707048.273922 },
    { input: "1851754189 - -342438312 % 261542420", output: 1932650081 },
    { input: "2117216307 - -1586173279 + -1473818130", output: 2229571456 },
    { input: "763943815 - -811545449 << 1701504013", output: 31326208 },
    { input: "1815637132 - -1021716844 >> 1144879829", output: -696 },
    { input: "-2060962556 - 1465365035 >>> -25323689", output: 91 },
    { input: "1620187282 - 1214919340 & 397508477", output: 270624100 },
    { input: "-822249439 - -1628232305 ^ -949719506", output: -143770436 },
    { input: "205431210 - -2040897127 | 1658864848", output: -404470575 },
    { input: "1287446095 << 1582004703 ** 2135393242", output: 1287446095 },
    { input: "756015895 << -619224558 * 2097737749", output: 756015895 },
    { input: "-693046303 << -1134919889 / -1168162655", output: -693046303 },
    { input: "-1681529797 << 888044842 % 2122693282", output: 395373568 },
    { input: "-442087329 << -1046776395 + -2136663991", output: -1073741824 },
    { input: "735972309 << 1789621378 - -1316802335", output: 1471944618 },
    { input: "821914838 << 1029255799 >> 686555465", output: 3506176 },
    { input: "-845480272 << 1341511764 >>> 1873229530", output: 58 },
    { input: "491633529 << 639740840 & 2100228491", output: 1294627072 },
    { input: "2080976205 << -1477065651 ^ -1614036088", output: -1167957112 },
    { input: "1732905918 << -1699008060 | 1171854959", output: 1979301871 },
    { input: "322941080 >> -1063879124 ** -2096070751", output: 322941080 },
    { input: "2001852264 >> 790147766 * -1229062947", output: 2001852264 },
    { input: "-1215167140 >> 1477250481 / 1836443652", output: -1215167140 },
    { input: "1727294886 >> -923033978 % 2032899757", output: 26988982 },
    { input: "-603606565 >> -805979214 + -498225124", output: -36842 },
    { input: "-1824088963 >> -143660020 - -319563759", output: -14 },
    { input: "-1216015785 >> 521063304 << -498188395", output: -1572864000 },
    { input: "-1036530497 >> 1125177182 >>> -921406064", output: 65535 },
    { input: "894255741 >> -176221935 & 1489286705", output: 4640 },
    { input: "1971456175 >> -865234238 ^ 1474466523", output: 1250038000 },
    { input: "160156195 >> -1820940646 | 1080595124", output: 1080595126 },
    { input: "-1232401974 >>> 875849348 ** -1721417929", output: 3062565322 },
    { input: "249477190 >>> 601579112 * 1837817728", output: 249477190 },
    { input: "-136593806 >>> -1252827811 / 701929942", output: 1 },
    { input: "-452883470 >>> 1632864858 % -597466192", output: 57 },
    { input: "865131548 >>> 777668226 + 91925808", output: 3300 },
    { input: "-695706374 >>> -1741160041 - 886803956", output: 449907615 }, 
    { input: "619923983 >>> 479098648 << 767722282", output: 36864 },
    { input: "-1851959912 >>> 1695864213 >> -952971417", output: 9 },
    { input: "1321991385 >>> 1464080060 & 436393734", output: 4 },
    { input: "-30645658 >>> -1236834908 ^ -441362853", output: -363622275 },
    { input: "-1372348165 >>> -1986989436 | 1352069101", output: 1526202351 },
    { input: "-222 & 242 ** 4", output: -865225216 },
    { input: "-844429658 & -159602314 * 1938153871", output: 1285621248 },
    { input: "-927050342 & 457264704 / -389569674", output: -927050342 },
    { input: "-1799098930 & -1419720018 % -1340683233", output: -1874727794 },
    { input: "1462705559 & 1821370390 + -899477277", output: 371333265 },
    { input: "-1151705285 & -519314912 - 2097661773", output: 536877587 },
    { input: "862307422 & 233154438 << -1992684945", output: 323026944 },
    { input: "2000075494 & -1282533478 >> -2075341951", output: 1359350468 },
    { input: "-471499609 & 333295080 >>> 1039732890", output: 4 },
    { input: "1070402339 & -2079145972 ^ -2018556552", output: -2085665416 },
    { input: "1835667420 & -1611752982 | -1410855502", output: -1343615494 },
    { input: "184426365 ^ -982537272 ** -1844410950", output: 184426365 },
    { input: "-893888453 ^ -519798670 * -1761881478", output: 1676731067 },
    { input: "1922892041 ^ -1174033988 / 682484927", output: -1922892042 },
    { input: "1957779659 ^ -706133485 % -1831176346", output: -1588061480 },
    { input: "1766199132 ^ -998993025 + -1515602671", output: 56123340 },
    { input: "-786503071 ^ -1938604815 - 777434085", output: -1895668883 },
    { input: "-583411203 ^ 679250613 << 1140561516", output: 361925117 },
    { input: "1324136266 ^ 564688728 >> 856363447", output: 1324136201 },
    { input: "-1509843863 ^ 809842249 >>> 476017243", output: -1509843857 },
    { input: "-1853323100 ^ -966064745 & 795665392", output: -1746892492 },
    { input: "-1361346161 ^ -1343328420 | 1287794075", output: 1308094427 },
    { input: "1354834023 | 538887543 ** -800717248", output: 1354834023 },
    { input: "1747756592 | -1515458245 * -1212878860", output: 2025629488 },
    { input: "-2086786526 | 1197918693 / -74526338", output: -14 },
    { input: "1838786209 | -940489821 % 482889324", output: -306596177 },
    { input: "-1510525443 | -1020204045 + 246675408", output: -168298497 },
    { input: "-1559878692 | 1527165676 - -1703898172", output: -476692484 },
    { input: "1211414545 | -618487022 << -255247929", output: -646596335 },
    { input: "2118282666 | 1730499282 >> -1346468243", output: 2118352298 },
    { input: "1678256728 | 1141102110 >>> 468422519", output: 1678256856 },
    { input: "1589171457 | -799008726 & 193535498", output: 1589173515 },
    { input: "-539590392 | -777792245 ^ -2024511470", output: -537412327 },
  ]
});

function numericalTest(entries: { [key: string]: TestEntry[] }) {
  console.log("========= [TEST START] =========");

  for (const unit in entries) {
    console.log(`========= [${unit.toUpperCase()} STARTED] =========`);

    const result = numericalUnitTest(entries[unit]);
    if (result) {
      console.log(`========= [${unit.toUpperCase()} FAILED] =========`);
      console.log(`Input: ${result.input}`);
      console.log(`Expected: ${result.expected}`);
      console.log(`Received: ${result.received}`);
      console.log("========= [TEST TERMINATED] =========");
      return;
    }

    console.log(`========= [${unit.toUpperCase()} PASSED] =========`);
  }

  console.log("========= [TEST SUCCESS] =========");
}

function numericalUnitTest(entries: TestEntry[]): TestEntryReturn | null {
  for (let i = 0; i < entries.length; i++) {
    const entry = entries[i];

    try {
      const received = calculator.calculate(entry.input);
      if (received !== entry.output) {
        return { input: entry.input, received, expected: entry.output };
      }
    } catch (error) {
      console.error(error);
      return { input: entry.input, received: NaN, expected: entry.output };
    }
  }
  return null;
}


type TestEntry = {
  input: string;
  output: number;
}

interface TestEntryReturn {
  input: string;
  expected: number;
  received: number;
}